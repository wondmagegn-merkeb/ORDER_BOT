<div class="container mx-auto px-4 py-6">
  <h1 class="text-3xl font-bold mb-4">Admin Audit Logs</h1>

  <!-- Search Form -->
  <div class="mb-4">
    <input
      type="text"
      id="searchInput"
      placeholder="Search by Action or Admin"
      class="w-full p-2 border rounded-md"
    />
  </div>

  <!-- Audit Log Table -->
  <table class="min-w-full bg-white border border-gray-300 rounded-md shadow-md">
    <thead>
      <tr>
        <th class="p-3 border-b text-left">ID</th>
        <th class="p-3 border-b text-left">Action</th>
        <th class="p-3 border-b text-left">Performed By</th>
        <th class="p-3 border-b text-left">Old Data</th>
        <th class="p-3 border-b text-left">New Data</th>
        <th class="p-3 border-b text-left">Date</th>
      </tr>
    </thead>
    <tbody id="auditTableBody">
      <% auditLogs.forEach(log => { %>
        <tr>
          <td class="p-3 border-b"><%= log.id %></td>
          <td class="p-3 border-b"><%= log.action %></td>
          <td class="p-3 border-b"><%= log.performedBy %></td>
          <td class="p-3 border-b"><%= JSON.stringify(log.oldData) %></td>
          <td class="p-3 border-b"><%= JSON.stringify(log.newData) %></td>
          <td class="p-3 border-b"><%= log.createdAt %></td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="mt-6 flex justify-end items-center space-x-2" id="paginationContainer">
    <!-- Pagination buttons will be added by JS -->
  </div>
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const auditTableBody = document.getElementById('auditTableBody');
  const rows = Array.from(auditTableBody.getElementsByTagName('tr'));
  const paginationContainer = document.getElementById('paginationContainer');

  const rowsPerPage = 5;
  let currentPage = 1;

  // Search functionality
  searchInput.addEventListener('input', function () {
    const searchQuery = this.value.toLowerCase();
    rows.forEach(row => {
      const action = row.cells[1].textContent.toLowerCase();
      const performedBy = row.cells[2].textContent.toLowerCase();
      row.style.display = (action.includes(searchQuery) || performedBy.includes(searchQuery)) ? '' : 'none';
    });
  });

  // Pagination rendering
  function displayPage(page) {
    const start = (page - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    rows.forEach((row, index) => {
      row.style.display = (index >= start && index < end) ? '' : 'none';
    });

    renderPagination();
  }

  function renderPagination() {
    paginationContainer.innerHTML = '';

    const totalPages = Math.ceil(rows.length / rowsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = `px-3 py-1 rounded-md border text-sm ${
        i === currentPage 
          ? 'bg-blue-500 text-white border-blue-500' 
          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100'
      }`;

      btn.addEventListener('click', () => {
        currentPage = i;
        displayPage(currentPage);
      });

      paginationContainer.appendChild(btn);
    }
  }

  // Init
  displayPage(currentPage);
</script>
