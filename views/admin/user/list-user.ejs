<div class="container mx-auto px-4 py-6">
  <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">User Management</h1>

  <!-- Search -->
  <div class="flex justify-start items-center mb-6">
    <div class="relative w-full max-w-md">
      <input type="text" 
             id="userSearchInput" 
             placeholder="Search by Status or Type" 
             class="w-full p-2 pl-10 border border-gray-300 rounded">
      <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
    </div>
  </div>

  <!-- User Table -->
  <table class="min-w-full bg-white border border-gray-300 rounded-md shadow-md">
    <thead>
      <tr>
        <th class="p-3 border-b text-left">User ID</th>
        <th class="p-3 border-b text-left">Telegram ID</th>
        <th class="p-3 border-b text-left">Full Name</th>
        <th class="p-3 border-b text-left">Username</th>
        <th class="p-3 border-b text-left">Phone 1</th>
        <th class="p-3 border-b text-left">Phone 2</th>
        <th class="p-3 border-b text-left">Status</th>
        <th class="p-3 border-b text-left">Type</th>
        <th class="p-3 border-b text-left">Action</th>
      </tr>
    </thead>
    <tbody id="userTableBody">
      <% users.forEach(user => { %>
        <tr>
          <td class="p-3 border-b"><%= user.userId %></td>
          <td class="p-3 border-b"><%= user.telegramId %></td>
          <td class="p-3 border-b"><%= user.fullName %></td>
          <td class="p-3 border-b"><%= user.phoneNumber1 %></td>
          <td class="p-3 border-b"><%= user.phoneNumber2 %></td>
          <td class="p-3 border-b"><%= user.status %></td>
          <td class="p-3 border-b"><%= user.status %></td>
          <td class="p-3 border-b"><%= user.userType %></td>
          <td class="p-3 border-b">
            <a href="/users/edit/<%= user.userId %>" class="text-yellow-500 hover:text-yellow-600">
              <i class="fas fa-edit"></i> Update
            </a>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="mt-6 flex justify-end items-center space-x-2" id="userPaginationContainer"></div>
</div>

<!-- Pagination + Search Script -->
<script>
  const userSearchInput = document.getElementById('userSearchInput');
  const userTableBody = document.getElementById('userTableBody');
  const userRows = Array.from(userTableBody.getElementsByTagName('tr'));
  const userPaginationContainer = document.getElementById('userPaginationContainer');

  const rowsPerPage = 5;
  let currentPage = 1;

  userSearchInput.addEventListener('input', function () {
    const query = this.value.toLowerCase();
    userRows.forEach(row => {
      const status = row.cells[3].textContent.toLowerCase();
      const type = row.cells[4].textContent.toLowerCase();
      row.style.display = (status.includes(query) || type.includes(query)) ? '' : 'none';
    });
  });

  function displayUserPage(page) {
    const start = (page - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    userRows.forEach((row, index) => {
      row.style.display = (index >= start && index < end) ? '' : 'none';
    });

    renderUserPagination();
  }

  function renderUserPagination() {
    userPaginationContainer.innerHTML = '';
    const totalPages = Math.ceil(userRows.length / rowsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = `px-3 py-1 rounded-md border text-sm ${
        i === currentPage 
          ? 'bg-blue-500 text-white border-blue-500' 
          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100'
      }`;

      btn.addEventListener('click', () => {
        currentPage = i;
        displayUserPage(currentPage);
      });

      userPaginationContainer.appendChild(btn);
    }
  }

  displayUserPage(currentPage);
</script>
